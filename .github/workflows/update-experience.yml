name: Update Experience Badge

on:
  schedule:
    - cron: '0 0 1 * *'  # Runs on the 1st of every month
  workflow_dispatch:  # Allows manual trigger

jobs:
  update-badge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Calculate Experience
        id: calc_experience
        run: |
          START_DATE="2022-07-01"
          CURRENT_DATE=$(date +%Y-%m-%d)
          DAYS=$(( ($(date -d "$CURRENT_DATE" +%s) - $(date -d "$START_DATE" +%s)) / 86400 ))
          YEARS=$(echo "scale=1; $DAYS / 365.25" | bc)
          echo "years=$YEARS" >> $GITHUB_OUTPUT
          echo "Calculated experience: $YEARS years"

      - name: Update README
        run: |
          YEARS="${{ steps.calc_experience.outputs.years }}"
          sed -i "s/Experience-[0-9.]\+%2B%20Years/Experience-${YEARS}%2B%20Years/g" README.md

      - name: Commit and Push Changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git diff --staged --quiet || (git commit -m "Update experience badge to ${{ steps.calc_experience.outputs.years }} years" && git push)

