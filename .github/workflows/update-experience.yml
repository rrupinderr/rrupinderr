name: Update Experience Badge

on:
  schedule:
    # Run on the 1st day of every month at 00:00 UTC
    - cron: "0 0 1 * *"
  workflow_dispatch: # Allow manual triggering

jobs:
  update-experience:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Calculate Experience Years
        id: calculate
        run: |
          python3 << 'EOF'
          from datetime import date
          import os

          start_date = date(2021, 7, 1)
          current_date = date.today()

          # Calculate days difference
          days = (current_date - start_date).days

          # Calculate years with one decimal place
          years = days / 365.25
          years_formatted = f"{years:.1f}"

          # Write to GITHUB_OUTPUT
          with open(os.environ['GITHUB_OUTPUT'], 'a') as f:
              f.write(f"years={years_formatted}\n")

          print(f"Calculated experience: {years_formatted} years")
          EOF

      - name: Update README
        run: |
          YEARS="${{ steps.calculate.outputs.years }}"

          # Update the badge URL in README.md
          sed -i "s/Experience-[0-9.]\\+%2B%20Years/Experience-${YEARS}%2B%20Years/g" README.md

          echo "Updated README with $YEARS years of experience"

      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git diff --staged --quiet || git commit -m "ðŸ¤– Auto-update experience badge: ${{ steps.calculate.outputs.years }} years"
          git push
